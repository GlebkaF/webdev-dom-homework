<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body id="body">
    <div class="container">
      <ul class="comments" id="comments">
      </ul>
      <div class="add-form" id="add-form">
        <input
          id="add-form-name"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          id="add-form-text"
          type="textarea"
          class="add-form-text "
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-form-button" >Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    // "use strict";
    const commentsElement = document.getElementById("comments");
    const addFormButtonElement = document.getElementById("add-form-button");
    const nameInputElement = document.getElementById("add-form-name");
    const textInputElement = document.getElementById("add-form-text");
    const form = document.getElementById("add-form");
    const comments = [
      {
        name: `Глеб Фокин`,
        date: `12.02.22 12:18`,
        comment: `Это будет первый комментарий на этой странице`,
        like: 3,
        activeLike: false,
      },
      {
        name: `Варвара Н.`,
        date: `13.02.22 19:22`,
        comment: `Мне нравится как оформлена эта страница! ❤`,
        like: 75,
        activeLike: false,
      },
    ]

  
const clickLike = () => {
  const likeButtons = document.querySelectorAll(".like-button");
    for (const likeButton of likeButtons) {
      likeButton.addEventListener('click', () => {
        console.log('d')
        const newLike = comments[likeButton.dataset.index];
        newLike.activeLike ? --newLike.like : ++newLike.like;
        newLike.activeLike = !newLike.activeLike;
        renderComment();
      })
    }
};


const replyToComment = () => {
  const commentBodys = document.querySelectorAll(".comment-body");
    for (const commentBody of commentBodys) {
      commentBody.addEventListener ('click', () => {
        const oldComment =  commentBody.dataset.text;
        const oldName = commentBody.dataset.name;
        console.log (oldComment);
        console.log (oldName);
        textInputElement.value += `${oldComment}\n${oldName}: `;
        // renderComment();
      })
  }
};


const renderComment = () => {
  const newComments = comments.map ((comment, index) => {
    return `<li class="comment">
        <div class="comment-header">
          <div>${comment.name}</div>
          <div>${comment.date}</div>
        </div>
        <div class="comment-body"  data-text="${comment.comment}" data-name="${comment.name}">
          <div class="comment-text">
            ${comment.comment}
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">${comment.like}</span>
            <button data-index="${index}" class='${comment.activeLike ? "like-button -active-like" : "like-button"}'></button>
          </div>
        </div>
      </li>`;
  }).join('');
  commentsElement.innerHTML = newComments;
  clickLike();
  replyToComment();
}


renderComment();


const plusZero = (str) => {
      return str < 10 ? `0${str}` : str;
    };

const now = (currentDate) => {
    let date = plusZero(currentDate.getDate());
    let month = plusZero(currentDate.getMonth() + 1);
    let hours = plusZero(currentDate.getHours());
    let mins = plusZero(currentDate.getMinutes());
    return `${date}.${month}.${currentDate.getFullYear() % 100} ${hours}:${mins}`;
  };

addFormButtonElement.classList.add("empty");
addFormButtonElement.disabled = true;

nameInputElement.addEventListener ('input',() => {
  if (nameInputElement.value === "" || textInputElement.value === "") {
    addFormButtonElement.classList.add("empty");
    addFormButtonElement.disabled = true;
  } else if (nameInputElement.value !== "" && textInputElement.value !== "") {
    addFormButtonElement.classList.remove("empty");
    addFormButtonElement.disabled = false;
  }});

textInputElement.addEventListener ('input', () => {
  if (textInputElement.value === "" || nameInputElement.value === "") {
    addFormButtonElement.classList.add("empty");
    addFormButtonElement.disabled = true;
  } else if (textInputElement.value !== "" && nameInputElement.value !== "") {
    addFormButtonElement.classList.remove("empty");
    addFormButtonElement.disabled = false;
  }});

// textInputElement.addEventListener ('input', check (textInputElement.value, nameInputElement.value));
// Функция которая не работает
// const check = (a,b) => {
//   if (a.value === "" || b.value === "") {
//     addFormButtonElement.classList.add("empty");
//     addFormButtonElement.disabled = true;
//   } else if (a.value !== "" && b.value !== "") {
//     addFormButtonElement.classList.remove("empty");
//     addFormButtonElement.disabled = false;
//   }};


nameInputElement.addEventListener ('input',() => {
  if (nameInputElement.value !== ""){
    nameInputElement.classList.remove("emptyTextName");
  }
});

textInputElement.addEventListener ('input',() => {
  if (textInputElement.value !== ""){
    textInputElement.classList.remove("emptyTextName");
  }
});

// const color = (a) => {
//   if (a !== ""){
//     a.classList.remove("emptyTextName");
//   }
// }

// textInputElement.addEventListener ('input', color);





const addNewComment = () => {
textInputElement.classList.remove("emptyTextName");
nameInputElement.classList.remove("emptyTextName");


if (nameInputElement.value === "" && textInputElement.value === ""){
  textInputElement.classList.add("emptyTextName");
  nameInputElement.classList.add("emptyTextName");
  return;
} else if (textInputElement.value === "") {
  textInputElement.classList.add("emptyTextName");
  return;
} else if (nameInputElement.value === "") {
  nameInputElement.classList.add("emptyTextName");
  return;
};

let currentDate = new Date();

comments.push(
  {
    name: nameInputElement.value
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;"),
    date: now(currentDate),
    comment: textInputElement.value
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;"),
    like: 0,
    activeLike: false,
  });
renderComment();

textInputElement.value = "";
nameInputElement.value = "";
}

addFormButtonElement.addEventListener("click", addNewComment);
form.addEventListener("keyup", (e) => {
  if (e.code === "Enter") addNewComment();
});

  </script>
</html>
