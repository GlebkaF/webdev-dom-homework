<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments" id="list">

      <!--список рендерится из js-->

    </ul>
    <div class="add-form">
      <input type="text" class="add-form-name" id="name-input" placeholder="Введите ваше имя" />
      <textarea type="textarea" class="add-form-text" id="comment-input" placeholder="Введите ваш коментарий"
        rows="4"></textarea>
      <div class="add-form-row">
        <button class="add-form-button" id="add-form-button">Написать</button>
      </div>
    </div>
  </div>
</body>

<style>
  .error {
    background-color: red;
  }

  .-active-like {
    background-image: url("data:image/svg+xml,%3Csvg width='22' height='20' viewBox='0 0 22 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15.95 0C14.036 0 12.199 0.882834 11 2.26703C9.801 0.882834 7.964 0 6.05 0C2.662 0 0 2.6267 0 5.99455C0 10.1035 3.74 13.4714 9.405 18.5613L11 20L12.595 18.5613C18.26 13.4714 22 10.1035 22 5.99455C22 2.6267 19.338 0 15.95 0Z' fill='%23BCEC30'/%3E%3C/svg%3E");
  }

   .comment-original {
    width: auto;
    height: auto;
    padding: 10px;
    margin-top: 10px;
    margin-bottom: 15px;
    font-size: 16px;
    color: black;
    background-color: rgb(222, 204, 245);
    border-radius: 8px;
    border: none;
  }
</style>
<script>
  "use strict";
  const buttonElement = document.getElementById("add-form-button");
  const listElement = document.getElementById("list");
  const nameInputElement = document.getElementById("name-input");
  const commentInputElement = document.getElementById("comment-input");
  let originalComment = document.getElementById("comment-original");


  //создание массива
  const comments = [
    {
      name: "Глеб Фокин",
      date: "12.02.22 12:18",
      text: "Это будет первый комментарий на этой странице",
      likesCounter: 3,
      itLikes: false,
      original: '',
      answer: '',

    },
    {
      name: "Варвара Н.",
      date: "13.02.22 19:22",
      text: "Мне нравится как оформлена эта страница! ❤",
      likesCounter: 75,
      itLikes: false,
      original: '',
      answer: '',

    },
  ]


  //добавление обработчика динамическим элементам
  const InitEventListeners = () => {
    const likeButtonElements = document.querySelectorAll(".like-button");
    for (const likeButtonElement of likeButtonElements) {
      likeButtonElement.addEventListener('click', () => {
        const index = likeButtonElement.dataset.index;
        if (comments[index]['itLikes'] === false) {
          comments[index]['likesCounter'] += 1;
          comments[index]['itLikes'] = true;
        } else {
          comments[index]['likesCounter'] -= 1;
          comments[index]['itLikes'] = false;
        }
        renderComments();
      })
    }
  }

  //ответ на комментарий по клику на комментарий
  const InitCommentListeners = () => {
    const EveryComments = document.querySelectorAll(".comment-text");
    for (const EveryComment of EveryComments) {
      EveryComment.addEventListener('click', () => {
        const index = EveryComment.dataset.index;
        originalComment = comments[index]['name'] + " " + comments[index]['text'];
       // comments[index]['original'] = comments[index]['name'] + " " + comments[index]['text'];
        //originalComment = comments[index]['original'];
        commentInputElement.value = originalComment + comments[index]['answer'];
        renderComments();
      })
    }
  }



  //рендерфункция
  const renderComments = () => {
    const commentsHtml = comments.map((comment, index) => {
      return `<li class="comment">
        <div class="comment-header">
          <div>${comment.name}</div>
          <div>${comment.date}</div>
        </div>
        <div class="comment-body">
          <div class=" ${(comments[index]['original'] != '') ? "comment-original" : ""}">
            ${comment.original}
          </div>
          <div class="comment-text" data-index = "${index}">
            ${comment.text}
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter" >${comment.likesCounter}</span>
            
            <button class="like-button ${(comments[index]['itLikes']) ? "-active-like" : ""}" data-index = "${index}"></button>
          </div>
        </div>
      </li>`;
    }).join('');
    listElement.innerHTML = commentsHtml;
    InitEventListeners();
    InitCommentListeners();
  };
  renderComments();


  //добавление комментария по клику на кнопку "написать"
  buttonElement.addEventListener('click', () => {
    nameInputElement.classList.remove("error");
    commentInputElement.classList.remove("error");
    if (nameInputElement.value === '') {
      nameInputElement.classList.add("error");
      return;
    } else if (commentInputElement.value === '') {
      commentInputElement.classList.add("error");
      return;
    }
   
    let myDate = new Date();
    comments.push({
      name: nameInputElement.value.replaceAll("<", "&lt;").replaceAll(">", "&gt;"),
      date: myDate.getDate() + ":" + (myDate.getMonth() + 1) +
        ":" + myDate.getFullYear() + " " + myDate.getHours() + ":" + myDate.getMinutes() + ":" + myDate.getSeconds(),
      text: commentInputElement.value.replace(originalComment, '').replaceAll("<", "&lt;").replaceAll(">", "&gt;"),
      likesCounter: 0,
      itLikes: false,
      original: originalComment,
      answer: '',

    });

    renderComments();
    nameInputElement.value = '';
    commentInputElement.value = '';
  });



  console.log("It works!");
</script>

</html>