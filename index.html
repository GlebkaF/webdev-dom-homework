<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments-list">
      </ul>
      <div class="add-form">
        <input id="name-input" value=""
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea id="comment-input" value=""
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-button">Написать</button>
          <button class="new-form-button" id="new-button">Удалить последний комментарий</button>
        </div>
      </div>
    </div>
  </body>
  <style>
    .error {
      background-color: rgb(232, 144, 14);
    }
  </style>
  <script>
    
    const buttonElement = document.getElementById('add-button');
    const listComments = document.getElementById('comments-list');
    const newComment = document.getElementById('comment-new');
    const nameElement = document.getElementById('comment-name');
    const dataElement = document.getElementById('comment-data');
    const textElement = document.getElementById('comment-text');
    const nameInputElement = document.getElementById('name-input');
    const commentInputElement = document.getElementById('comment-input');
    const likeElement = document.getElementById('like-text');
    const newButton = document.getElementById('new-button');

    const getCurrentDate = () => {
      const currentDate = new Date();
      const year = String(currentDate.getFullYear()).slice(-2);
      const month = String(currentDate.getMonth() + 1).padStart(2,'0');
      const day = String(currentDate.getDate()).padStart(2,'0');
      const hours = String(currentDate.getHours()).padStart(2,'0');
      const minutes = String(currentDate.getMinutes()).padStart(2,'0');
      const seconds = String(currentDate.getSeconds()).padStart(2,'0');
      const resultDate = `${day}.${month}.${year} ${hours}:${minutes}`;
      return resultDate;
    }

    const comments = [
  {
    name: "Глеб Фокин",
    date: "12.02.22 12:18",
    text: "Это будет первый комментарий на этой странице",
    like: 3,
    active: false
  },
  {
    name: "Варвара Н.",
    date: "13.02.22 19:22",
    text: "Мне нравится как оформлена эта страница! ❤",
    like: 75,
    active: true
  }
];

const clickLike = (event) => {
  const index = event.target.dataset.index;
  const comment = comments[index];
  if(!comment.active) {
    comment.active = true;
    comment.like++;
  } else {
    comment.active = false;
    comment.like--;
  }
  renderComments();

}

const renderComments = () => {
  const commentsHtml = comments.map((comment, index) => {
    if (comment.active === true) {
      comment.active = '-active-like';
    }
      return `<li class="comment" id="comment-new">
          <div class="comment-header">
            <div id="comment-name">${comment.name}</div>
            <div id="comment-data">${comment.date}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text" id="comment-text">
              ${comment.text}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter" id="like-text" value="">${comment.like}</span>
              <button class="like-button ${comment.active}" data-index="${index}""></button>
            </div>
          </div>
        </li>`;
    }).join('');
    listComments.innerHTML= commentsHtml;

    const buttonLikes = document.querySelectorAll('.like-button');
    buttonLikes.forEach((button) => {
      button.addEventListener('click', clickLike);
    })
  }

  renderComments();

 
const getElement = () => {
  nameInputElement.classList.remove('error');
  commentInputElement.classList.remove('error');
      

      if(nameInputElement.value === '') {
        buttonElement.disabled = true;
        buttonElement.style.backgroundColor = 'gray';
        nameInputElement.classList.add('error');
        return;
      } if (commentInputElement.value === '') {
        buttonElement.disabled = true;
        buttonElement.style.backgroundColor = 'gray';
        commentInputElement.classList.add('error');
        return;
      }

    comments.push({
    name: nameInputElement.value,
    date: getCurrentDate(),
    text: commentInputElement.value,
    like: 0,
    })

  nameInputElement.value = '';
  commentInputElement.value = '';
  nameInputElement.classList.remove('error');
  commentInputElement.classList.remove('error');

  renderComments();
    
}

buttonElement.addEventListener('click', () => {
  getElement();
})

nameInputElement.addEventListener('input', () => {
    buttonElement.disabled = false;
    buttonElement.style.backgroundColor = '';
    nameInputElement.classList.remove('error');
    }) 
    
  commentInputElement.addEventListener('input', () => {
    buttonElement.disabled = false;
    buttonElement.style.backgroundColor = '';
    commentInputElement.classList.remove('error');
    }) 

  newButton.addEventListener('click', () => {
    comments.pop();
    renderComments();
  })



document.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        getElement();
      }
    })
    

    console.log('It works!');
  </script>
</html>