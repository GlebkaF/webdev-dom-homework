<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul id="list" class="comments">
      </ul>
      <div class="add-form">
        <input
          id="name-input"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
        id="comment-input"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button id="add-button" class="add-form-button">Написать</button>
        </div>
          <button id="delete-button" class="add-form-delete">Удалить</button>
        </div>
      
    </div>
  </body>
  
  <script>
    "use strict";
    // Код писать здесь            data-text = '${item.comment}' data-name = '${item.name}'>
    const buttonElement = document.getElementById('add-button');
    const listElement = document.getElementById('list');
    const nameInputElement = document.getElementById('name-input');
    const commentInputElement = document.getElementById('comment-input');
    const deleteButtonElement = document.getElementById('delete-button');
    
    const commentsArray = [
      {
        name: 'Глеб Фокин',
    date: '12.02.22 12:18',
    comment: 'Это будет первый комментарий на этой странице',
    like: 3,
    userLike: false,
    paint: ''
  },
      
      {
        name: 'Варвара Н.',
    date: '13.02.22 19:22',
    comment: 'Мне нравится как оформлена эта страница! ❤',
    like: 75,
    userLike: true,
    paint: '-active-like'
      }
    ];
    
    const handleLike = () => {
      const likeButtons = document.querySelectorAll('.like-button'); 
      for (const likeButton of likeButtons) {
        likeButton.addEventListener('click', (event) => { 
          event.stopPropagation();
          const index = likeButton.dataset.index;
          //console.log(
          //  'Индекс кнопки лайка на которой произошел клик: ' + index
         // );
         // let counter = comments[index]['like_counter'];
         //const index = likeButton.dataset.index;
      if (commentsArray[index].userLike === false) {
        commentsArray[index].paint = '-active-like'; // добавить класс для закрашивания кнопки
        commentsArray[index].like += 1;
        commentsArray[index].userLike = true;
      } else {
        commentsArray[index].paint = ''; // удалить класс для закрашивания кнопки
        commentsArray[index].like -= 1;
        commentsArray[index].userLike = false;
      }
         renderComments();
        });
      }
    };
    const renderComments = () => {
      const newComments = commentsArray.map((item, index) => {
          return `<li data-index= "${index}"  class="comment">
          <div class="comment-header">
            <div>${item.name}</div>
            
            <div>${item.date}</div>
          </div>
          <div class = "comment-body"> 
   
            <div class = "comment-text">
              ${item.comment}
            </div>
          </div>
          <div class = "comment-footer">
            <div class = "likes">
              <span class = "likes-counter">${item.like}</span>
              <button data-index = '${index}' class = "like-button ${item.paint}"></button>
            </div>
          </div>
        </li>`
        })
        .join('');

      listElement.innerHTML = newComments;
      handleLike();
      answerComment();
    };
    renderComments();
    buttonElement.disabled = true;
nameInputElement.addEventListener('input', () =>{
  if (nameInputElement.value  === '' ) {
    buttonElement.disabled = true;
    return;
  } else {
    buttonElement.disabled = false;
  }
})

buttonElement.addEventListener('click', () => {
    nameInputElement.classList.remove('error');
    commentInputElement.classList.remove('error');
    
    if ((nameInputElement.value || commentInputElement.value) === '') {
      nameInputElement.classList.add('error');
      commentInputElement.classList.add('error');
      return;
    }

  //  const plusZero = (str) => {
   //   if (str < 10) return `0${str}`;
   // };
    
   // const getDateNow = () => { 
   // let currentDate = new Date();
   // console.log(
  //      currentDate.toLocaleDateString(),
   //     currentDate.toLocaleTimeString()
   //   );
   //   return `${currentDate.toLocaleDateString()} ${currentDate
     //   .toLocaleTimeString()
    //    .slice(0, 5)}`;
   // };


   const date = new Date();
  const formattedDate =
  date.getDate().toString().padStart(2, '0') + '.' + 
  (date.getMonth() + 1).toString().padStart(2, '0') + '.' +
  date.getFullYear().toString().slice(-2) + ' ' +
  date.getHours().toString().padStart(2, '0') + ':' +
  date.getMinutes().toString().padStart(2, '0');

  // nameInputElement.classList.remove("error");  class='quote'
    
      commentsArray.push({
        name: nameInputElement.value
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;"),
      date: formattedDate,
      comment: commentInputElement.value
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("%BEGIN_QUOTE", "<div >")
            .replaceAll("END_QUOTE%", "</div>"),
 
        like: 0,
        userLike:false,
        paint: '',
      });
      renderComments();
        nameInputElement.value = '';
        commentInputElement.value = '';
        buttonElement.disabled = true;
        
    });

    function answerComment() {
  const oldComments = document.querySelectorAll('.comment');

  for (const oldComment of oldComments) {
    oldComment.addEventListener('click', (event) =>{
      event.stopPropagation();

      const index = oldComment.dataset.index;
      const comment = commentsArray[index];

      commentInputElement.value = `%BEGIN_QUOTE${commentsArray[index].name} \n
      ${comment.comment}END_QUOTE%`
    })
  }
}

deleteButtonElement.addEventListener('click', () =>{
  const lastCommentIndex = listElement.innerHTML.lastIndexOf( '<li class="comment">' );
  if (lastCommentIndex !== -1) {
    listElement.innerHTML = listElement.innerHTML.substring( 0, lastCommentIndex ); 
  }
});


document.addEventListener('keyup', (event) =>{
  if (event.key === 'Enter') {
    buttonElement.click();
  }
});
    console.log("It works!");
  </script>
</html>