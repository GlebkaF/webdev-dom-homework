<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul id="comment-script" class="comments">
        <!-- <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li> -->
        <!-- <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div id="new-time">13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li> -->
      </ul>
      <div class="add-form">
        <input id="input-accept-name"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea id="textarea-accept-comment"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button id="add-button" class="add-form-button">Написать</button>
					<button id="delete-button" class="add-form-button">Удалить</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
		// Объявляю константы для хранения данных
		const buttonElement = document.getElementById('add-button');
		const listElement = document.getElementById('comment-script');
		const acceptName = document.getElementById('input-accept-name');
		const acceptComment = document.getElementById('textarea-accept-comment');
		const buttonDelete =  document.getElementById('delete-button');

			// Доп. задание - делаю кнопку неактивной при незаполненом поле
		function checkInputs() {
		if (acceptName.value.trim() === "" || acceptComment.value.trim() === "") {
			buttonElement.disabled = true;
			buttonElement.classList.add("gray");
		} else {
			buttonElement.disabled = false;
			buttonElement.classList.remove("gray");
		};
	};
		acceptName.addEventListener("input", checkInputs);
		acceptComment.addEventListener("input", checkInputs);
		checkInputs();

	// 	// Доп. задание - добавляю кнопку удалить и пишу её функционал
	buttonDelete.addEventListener('click', () => {
		const lastIndex = listElement.innerHTML.lastIndexOf('<li class="comment">');
			if (lastIndex !== -1) {
			listElement.innerHTML = listElement.innerHTML.substring(0, lastIndex);
		};
	});
	
	// Функция, которая делает кнопку "удалить" неактивной когда в массиве нет элементов
	function inactiveDeleteButton() {
		if (commentators.length === 0) {
			
			buttonDelete.disabled = true;
			buttonDelete.classList.add("gray-delete");
		} else {
			buttonDelete.disabled = false;
			buttonDelete.classList.remove("gray-delete");
		}
	};
	// inactiveDeleteButton();

		// // Делаю доп.задание отправляю коммент по нажатию клавиши
		document.addEventListener('keydown', function(e) {
				if (e.key === 'Enter') {
					buttonElement.click();
				}
			})

		//Добавляю функцию лайка
		const addLikeButtonEventListener = () => {
			const likesButtonElement = document.querySelectorAll('.like-button');
    for (const likeButton of likesButtonElement) {
			let isLike = false;
			likeButton.addEventListener("click", event => {
				event.stopPropagation();
				// isLike = !isLike;
				// likeButton.classList.toggle('-active-like', isLike);
				const index = likeButton.dataset.index;
				if (commentators[index].isLike === false) {
					commentators[index].isLike = true;
					commentators[index].like++;
					// likeButton.classList.add('-active-like');
				} else {
					commentators[index].isLike = false;
					commentators[index].like--;
					// likeButton.classList.remove('-active-like');
				}
				likeButton.classList.toggle('-active-like', commentators[index].isLike);
				renderCommentators();
				checkInputs();
			});
		};
	};

	let userСomment; 
	// ДЗ 2.11 --- Реализую ответ на комментарий
	const replyToCommentFunction = () => {
		const replyComments = document.querySelectorAll('.comment-text');
		const commentTextArea = document.getElementById('textarea-accept-comment');
		for (const replyComment of replyComments) {
			replyComment.addEventListener("click", event => {
				event.stopPropagation();
				console.log('s');
				userСomment = replyComment.dataset.text;
				commentTextArea.value = text;
				
				
				renderCommentators();
				checkInputs();
			});
		};
	};

		//Добавляю массив на основе разметки HTML 
		const commentators = [
			{
				name: "Глеб Фокин",
				data: "12.02.22 12:18",
				comment: "Это будет первый комментарий на этой странице",
				like: "3",
				isLike: false,
			},
			{
				name: "Варвара Н.",
				data: "13.02.22 19:22",
				comment: "Мне нравится как оформлена эта страница! ❤",
				like: "75",
				isLike: false,
			}
			];

			//Рендер функция
			const renderCommentators = () => {
			const commentatorHTML = commentators.map((commentator, index) => {
					return `<li class="comment">
          <div data-name="${commentator.name}" class="comment-header">
            ${commentator.name}
            <div>${commentator.data}</div>
          </div>
          <div class="comment-body">
            <div data-text=">-${commentator.comment}" class="comment-text">
              ${commentator.comment}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span data-like="0" class="likes-counter">${commentator.like}</span>
              <button class="like-button ${commentator.isLike ? '-active-like' : ''}" data-index="${index}" ></button>
            </div>
          </div>
        </li>`;
				}).join("");
				listElement.innerHTML = commentatorHTML;
				addLikeButtonEventListener();
				replyToCommentFunction();
			};
			

			buttonElement.addEventListener("click", () => {
				// Перенёс объявление переменных даты сюда.. Аааа, понял логику) 
				const currentDate = new Date();
			const formattedDate = currentDate.toLocaleDateString('ru-RU');
			const formattedTime = `${currentDate.getHours().toString().padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}`;
				//Добавляю нового комментатора
				commentators.push({
				name: acceptName.value,
				data: [formattedDate, formattedTime],
				comment: acceptComment.value,
				like: "0",
				isLike: false,
			});
			renderCommentators();
		});
		renderCommentators();
		checkInputs();
	
	
				// listElement.innerHTML = oldlist + `<li class="comment">
			  //     <div class="comment-header">
			  //       ${acceptName.value}
			  //       <div>${formattedDate}  ${formattedTime}</div>
			  //     </div>
			  //     <div class="comment-body">
			  //       <div class="comment-text">
			  //         ${acceptComment.value}
			  //       </div>
			  //     </div>
			  //     <div class="comment-footer">
			  //       <div class="likes">
			  //         <span class="likes-counter">0</span>
			  //         <button class="like-button"></button>
			  //       </div>
			  //     </div>
			  //   </li>`;
	



			// Добавляю красный фоновый цвет при незаполненом поле (Эта функция оказывается бессмысленной после создания неактивной кнопки)
		// buttonElement.addEventListener('click', () => {
		// 	acceptComment.classList.remove("error");
		// 	acceptName.classList.remove("error");
		// 	if (acceptName.value === "" || acceptComment.value === "") {
    //     acceptName.classList.add("error");
		// 		acceptComment.classList.add("error");
    //     return;
    //   };
		// });
	
// Так же делаю основной функционал добавления комментария 
		// 	const oldlist = listElement.innerHTML;
			
		// 	listElement.innerHTML = oldlist + `<li class="comment">
    //       <div class="comment-header">
    //         ${acceptName.value}
    //         <div>${formattedDate}  ${formattedTime}</div>
    //       </div>
    //       <div class="comment-body">
    //         <div class="comment-text">
    //           ${acceptComment.value}
    //         </div>
    //       </div>
    //       <div class="comment-footer">
    //         <div class="likes">
    //           <span class="likes-counter">0</span>
    //           <button class="like-button"></button>
    //         </div>
    //       </div>
    //     </li>`
		// });


  </script>
</html>

