<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="list">
      <!--список js-->
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          id="add-name"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
          id="add-comment"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-button">Написать</button>
        </div>
      </div>
    </div>
  </body>
<style>
  .error{
    background-color: darksalmon;
  }
</style>
  <script>
    "use strict";
   const buttonElement = document.getElementById("add-button");
   const listElement = document.getElementById("list");
   const nameElement = document.getElementById("add-name");
   const commentElement = document.getElementById("add-comment");

   const commentsArray = [
      {
        name: "Глеб Фокин",
        date: "12.02.22 12:18",
        comment: "Это будет первый комментарий на этой странице",
        like: 3,
        itLike: false
      },
      {
        name: "Варвара Н.",
        date: "13.02.22 19:22",
        comment: "Мне нравится как оформлена эта страница! ❤",
        like: 75,
        itLike: true
      }
    ];
    const likeButtonClick = () => {
      const userLikes = document.querySelectorAll(".like-button");
      for (const userLike of userLikes) {
        userLike.addEventListener("click", () => {
          const index = userLike.dataset.index;
          if (commentsArray[index].itLike === false) {
            commentsArray[index].like++;
            commentsArray[index].itLike = true;
          } else {
            commentsArray[index].like--;
            commentsArray[index].itLike = false;
          }
          console.log(commentsArray[index].itLike);
          renderComments();
        });
      }
    };
    const renderComments = () => {
      const commentsHtml = commentsArray
        .map((user, index) => {
          return `<li class="comment" >
          <div class="comment-header">
            <div>${user.name}</div>
            <div>${user.date}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
            ${user.comment}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${user.like}</span>
              <button data-index="${index}" class="like-button  ${
            user.itLike ? "-active-like" : ""
          }"></button>
            </div>
          </div>
        </li>`;
        })
        .join("");

      listElement.innerHTML = commentsHtml;
      likeButtonClick();
    };
    renderComments();

   let date = new Date();
   let m = date.getMonth()+1;
   if(m<10){
    m = '0'+m;
   }
   let y = date.getFullYear()%100;
   if(y<10){
    y='0'+y;
   }
   let minu = date.getMinutes();
   if(minu<10){
    minu = '0'+minu;
   }
   let myDate = date.getDate() + '.' + m + '.' + y + ' ' + date.getHours() + ':' + minu;

   buttonElement.addEventListener('click', () => {

    nameElement.classList.remove("error");

    if(nameElement.value === ""){
      nameElement.classList.add("error");
      return;
    }

    commentElement.classList.remove("error");

    if(commentElement.value === ""){
      commentElement.classList.add("error");
      return;
    }

    commentsArray.push({
        name: nameElement.value,
        date: myDate,
        comment: commentElement.value,
        like: 0,
        itLike: false
      });

      renderComments();
   })
  </script>
</html>
