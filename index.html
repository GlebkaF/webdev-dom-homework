<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments" id="commentsList">
      <!--Список рендерится из JS-->
    </ul>
    <div class="add-form">
      <input type="text" class="add-form-name" placeholder="Введите ваше имя" id="nameInput" />
      <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"
        id="textInput"></textarea>
      <div class="add-form-row">
        <button class="add-form-button" id="add-button">Написать</button>
        <button class="add-form-button" id="cancel-button">Удалить коментарий</button>
      </div>
    </div>
  </div>
</body>

<style>
  .disabledButton {
    background-color: gainsboro;
    color: grey;
  }
</style>

<script>
  "use strict";
  const buttonElement = document.getElementById('add-button');
  const nameInputElement = document.getElementById('nameInput');
  const textInputElement = document.getElementById('textInput');
  const commentsListElement = document.getElementById('commentsList');
  const cancelButtonElement = document.getElementById('cancel-button');


  const comments = [
    {
      name: 'Глеб Фокин',
      date: '12.02.22 12:18',
      text: 'Это будет первый комментарий на этой странице',
      likes: 3,
      isLiked: 'no',
      isEdit: false
    },
    {
      name: 'Варвара Н.',
      date: '13.02.22 19:22',
      text: 'Мне нравится как оформлена эта страница! ❤',
      likes: 75,
      isLiked: 'no',
      isEdit: false
    }
  ];

  function getDate(currentDate = new Date()) {
    let day = currentDate.getDate();
    let month = currentDate.getMonth() + 1;
    let year = currentDate.getFullYear().toString().substr(-2);
    let hour = currentDate.getHours();
    let minutes = currentDate.getMinutes();
    if (month < 10) {
      month = "0" + month;
    }
    if (minutes < 10) {
      minutes = "0" + minutes;
    }
    if (day < 10) {
      day = "0" + day;
    }

    return day + '.' + month + '.' + year + ' ' + hour + ':' + minutes;
  };

  // const initEditButtonListeners = () => {
  //   const editButtonElements = document.querySelectorAll('.edit-button');
  //   for (const editButtonElement of editButtonElements) {
  //     editButtonElement.addEventListener('click', () => {
  //       const index = editButtonElement.dataset.index;

  //       if (comments[index].isEdit === false) {
  //         comments[index].isEdit = true;
  //       }
  //       else {
  //         comments[index].isEdit = false;
  //       }
  //       renderComments();
  //     });
  //   };
  //   for (const editButtonElement of editButtonElements) {
  //     const index = editButtonElement.dataset.index;
  //     if (comments[index].isEdit === true) {

  //     }
  //   }
  // }

  const initLikeButtonListeners = () => {
    const likeButtonElements = document.querySelectorAll('.like-button');
    for (const likeButtonElement of likeButtonElements) {
      likeButtonElement.addEventListener('click', () => {
        const index = likeButtonElement.dataset.index;

        if (comments[index].isLiked === 'no') {
          comments[index].likes = ++comments[index].likes;
          comments[index].isLiked = 'yes';
        }

        else {
          comments[index].likes = --comments[index].likes;
          comments[index].isLiked = 'no';
        }
        renderComments();
      });
    };
    for (const likeButtonElement of likeButtonElements) {
      const index = likeButtonElement.dataset.index;
      if (comments[index].isLiked === 'yes') {
        likeButtonElement.classList.add('-active-like');
      }
      else {
        likeButtonElement.classList.remove('-active-like');
      }
    };
  };



  const renderComments = () => {
    const commentsHtml = comments
      .map((comment, index) => {
        return `<li class="comment">
        <div class="comment-header">
          <div>${comment.name}</div>
          <div>${comment.date}</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            ${comment.text}
          </div>
        </div>
        <div class="comment-footer">
          <div class="edit">
            <button data-index='${index}' class="edit-button">Edit</button>
          </div>
          <div class="likes">
            <span class="likes-counter">${comment.likes}</span>
            <button data-index='${index}' class="like-button"></button>
          </div>
        </div>  
      </li>`;
      })
      .join('');
    commentsListElement.innerHTML = commentsHtml;
    initLikeButtonListeners();
  };
  renderComments();






  buttonElement.disabled = true;
  buttonElement.classList.add('disabledButton');
  buttonElement.classList.remove('add-form-button:hover');

  nameInputElement.addEventListener('input', () => {
    buttonElement.disabled = false;
    buttonElement.classList.remove('disabledButton');
    if (nameInputElement.value === '' || textInputElement.value === '') {
      buttonElement.disabled = true;
      buttonElement.classList.add('disabledButton');
    }
    return;
  });

  textInputElement.addEventListener('input', () => {
    buttonElement.disabled = false;
    buttonElement.classList.remove('disabledButton');
    if (nameInputElement.value === '' || textInputElement.value === '') {
      buttonElement.disabled = true;
      buttonElement.classList.add('disabledButton');
    }
    return;
  });

  buttonElement.addEventListener('click', () => {
    comments.push({
      name: nameInputElement.value,
      date: getDate(),
      text: textInputElement.value,
      likes: 0,
      isLiked: 'no',
      isEdit: false
    });
    renderComments();
    nameInputElement.value = '';
    textInputElement.value = '';
  });

  textInputElement.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      buttonElement.click();
    }
  });

  cancelButtonElement.addEventListener('click', () => {
    let str = commentsListElement.innerHTML.lastIndexOf('<li class="comment">');
    commentsListElement.innerHTML = commentsListElement.innerHTML.slice(0, str);
  });

</script>

</html>