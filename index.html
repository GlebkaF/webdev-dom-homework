<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="list-comments">
        <!-- Список рендерится из Js -->
      </ul>
      <div class="add-form">
        <input id="name-input"
          type="text" 
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea id="textarea-input"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-button">Написать</button>
          <button class="add-form-button" id="delete-button">Удалить коментарий</button>
          
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
    console.log("It works!");
    
    // Код писать здесь
    
    const ulElement = document.getElementById("list-comments");

		const setActiveButtonInput = () => {
      
      
			nameInputElement.addEventListener(('input'),
      
       () => { //привожу кнопку в порядок после инпута:
			buttonElement.classList.remove('disabled-hover');//Делаю кнопку активной после ввода данных в инпут
			buttonElement.removeAttribute('disabled', '');//Делаю кнопку активной после ввода данных в инпут
			nameInputElement.classList.remove('err');
      
		});	
		}

		const setActiveButtonMessage = () => {
      
			textareaInputElement.addEventListener(('input'), () => { 
      //привожу кнопку в порядок после текстареа:
			buttonElement.classList.remove('disabled-hover');
      //Делаю кнопку активной после ввода данных в текстареа
      
			buttonElement.removeAttribute('disabled', '');
      
      //Делаю кнопку активной после ввода данных в текстареа
			textareaInputElement.classList.remove('err');
      
     
     
      
		});	
    

		}

		const disabledButton = () => {
     // Делаю кнопку неактивной
      
			buttonElement.setAttribute('disabled', '');
			buttonElement.classList.add('disabled-hover');
      
     
		}

		const submitEnter = (event) => { // отправка сообщения по Enter
			if (event.keyCode === 13) {
            document.getElementById("add-button").click();
            nameInputElement.value = "";
            textareaInputElement.value = "";
        }
		}

    
		
		


    const buttonElement = document.getElementById('add-button');
    const buttonElementDel = document.getElementById("delete-button");
    const listElement = document.getElementById('list-comments');
    const nameInputElement = document.getElementById('name-input');
    const textareaInputElement = document.getElementById('textarea-input');
    
    setActiveButtonInput();//Делаем кнопку активной после ввода поля
   
		setActiveButtonMessage();//Делаем кнопку активной после ввода поля

    

    const getDateNow = () => {
      const dateNow = new Date();
      let day = dateNow.getDate();
      let month = dateNow.getMonth() + 1;
      let year = dateNow.getFullYear() % 1000;
      let hour = dateNow.getHours();
      let minute = dateNow.getMinutes();
      if (day < 10) {
        day = "0" + day; 
      }
      if (month < 10) {
        month = "0" + month; 
      }
      if (hour < 10) {
        hour = "0" + hour; 
      }
      if (minute < 10) {
        minute = "0" + minute; 
      }
      return `${day}.${month}.${year} ${hour}:${minute}`
    }

        buttonElement.addEventListener('click', () => {
        nameInputElement.classList.remove('err');
        textareaInputElement.classList.remove('err');
      if (nameInputElement.value === '') {
         nameInputElement.classList.add('err');
        disabledButton();
        return;
        
			} else if (textareaInputElement.value === '') 

       {
        
        textareaInputElement.classList.add('err');
				disabledButton();
       return;
        } else {
      
    
    
      
       
        
     
      
    
    listElement.innerHTML = listElement.innerHTML + `<li class="comment">
          <div class="comment-header">
            <div>${nameInputElement.value}</div>
            <div>${getDateNow()}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${textareaInputElement.value}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">0</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>`;

    }
  }

    );
    document.addEventListener("keyup", submitEnter);

				buttonElementDel.addEventListener(('click'), () => { //Удаляю последний элемент (комментарий);
					document.getElementById('list-comments').lastElementChild.remove();
				});



        
  const commentsArray = [
  {
    name: 'Глеб Фокин',
    date: '12.02.22 12:18',
    comment: 'Это будет первый комментарий на этой странице',
    like: 3,
    userLike: false,
    paint: ''
  },
  {
    name: 'Варвара Н.',
    date: '13.02.22 19:22',
    comment: 'Мне нравится как оформлена эта страница! ❤',
    like: 75,
    userLike: true,
    paint: '-active-like'
  }
];

const likes = () => {
  const likeButtons = document.querySelectorAll('.like-button');
  for (const likeButton of likeButtons) {
    likeButton.addEventListener('click', () => {
      const index = likeButton.dataset.index;
      if (commentsArray[index].userLike === false ) {
        commentsArray[index].paint = '-active-like';
        commentsArray[index].like += 1;
        commentsArray[index].userLike = true;
      } else {
        commentsArray[index].paint = '';
        commentsArray[index].like -= 1;
        commentsArray[index].userLike = false;
      }
      renderComments();
    });
  };
};


const renderComments = () => {
  const commentsHtml = commentsArray.map((item, index) =>{
    return `
    <li class="comment">
          <div class="comment-header">
            <div>${item.name}</div>
            <div>${item.date}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${item.comment}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${item.like}</span>
              <button data-index='${index}' class="like-button ${item.paint}"</button>
            </div>
          </div>
        </li>
    `})
    .join('');
    ulElement.innerHTML = commentsHtml;
    likes();
};
renderComments();
commentsArray.push({  
      name: nameInputElement.value,
      date: newformatDate,
      comment: textareaInputElement.value,
      like: 0,
      userLike: false,
      paint: '',
  });
    renderComments();

    nameInputElement.value = '';
    textareaInputElement.value = '';
    buttonElement.disabled = true;


   
  </script>
</html>
