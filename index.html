<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments-area">
        <!-- Рендерится из JS -->
      </ul>
      <div class="add-form" id="inputs">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          id="name-input"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
          id="comment-input"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-comment-button">Написать</button>
        </div>
        <div class="add-form-row">
          <button class="add-form-button" id="delete-comment-button">Удалить последний комментарий</button>
        </div>
      </div>
    </div>
  </body>
  <style>
    .validation {
      box-shadow: 0 0 10px 4px rgba(255, 0, 0, 1);
    }
    .active-like-button {
      background-color: #BCEC30;
    }

    
  </style>

  <script>
    "use strict";
    const commentsArea = document.getElementById("comments-area");
    const nameElement = document.getElementById("name-input");
    const commentElement = document.getElementById("comment-input");
    const addCommentElement = document.getElementById("add-comment-button");
    const removeCommentElement = document.getElementById("delete-comment-button");

  
   
    const comments = [
      {
        name: "Глеб Фокин",
        comment: "Это будет первый комментарий на этой странице",
        date: "12.02.22 12:18",
        likes: 3,
      },
      {
        name: "Варвара Н",
        comment: "Мне нравится как оформлена эта страница! ❤",
        date: '13.02.22 19:22',
        likes: 75,
      },
    ]


    let liked = 0;
    const likeCountButtonListener = () => {
      const likeButtonElements = document.querySelectorAll('.like-button');
      for (const likeButtonElement of likeButtonElements) {
        likeButtonElement.addEventListener("click", () => {
          let index = likeButtonElement.dataset.index;
          if (liked === 0) {
            comments[index].likes++;
            liked++;
          } else {
            comments[index].likes--
            liked--;
          }
          renderComments();
      })
      }
    }

    const likeButtonListener = () => {
      const likeButtonElements = document.querySelectorAll('.like-button');
      for (const likeButtonElement of likeButtonElements) {
        likeButtonElement.addEventListener("click", () => {
          likeButtonElement.classList.toggle("-active-like");
          renderComments();
      })       
      }
    }
    likeCountButtonListener();
    likeButtonListener();


    const renderComments = () => {
      const commentsHtml = comments.map((i, index) => {
        return `<li class="comment">
          <div class="comment-header">
            <div>${i.name}</div>
            <div>${i.date}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${i.comment}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${i.likes}</span>
              <button data-index="${index}" id="likes-button" class="like-button"></button>
            </div>
          </div>
        </li>`
      }).join('');
      commentsArea.innerHTML = commentsHtml;
      likeButtonListener();
      likeCountButtonListener();

    }
    renderComments();
    



    // Удаляет последний комментарий
    removeCommentElement.addEventListener("click", () => {
      comments.splice(-1);
      renderComments();
    })

    // Выключает кнопку при пустых инпутах
    window.addEventListener('input', () => {
      if (nameElement.value === "" || commentElement.value === "") {
      addCommentElement.disabled = true;
    } else {
      addCommentElement.disabled = false;
    }
    });

    // Кнопка Enter 
    window.addEventListener('keyup', () => {
      if (event.key === 'Enter') {
          addCommentElement.click();
        }
    });

    // Отправка комментариев
    addCommentElement.addEventListener("click", () => {
      nameElement.classList.remove("validation");
      commentElement.classList.remove("validation");

      if (nameElement.value == "" && commentElement.value == "") {
        nameElement.classList.add("validation");
        commentElement.classList.add("validation");
        return;
      } else if (commentElement.value == "") {
        commentElement.classList.add("validation");
        return;
      } else if (nameElement.value == "") {
        nameElement.classList.add("validation");
        return;
      };

      const date = new Date;
        let minutes = date.getMinutes();
          if (minutes < 10) {
            minutes = "0" +  minutes;
          }
        let hours = date.getHours();
          if (hours < 10) {
            hours = "0" + hours;
          }
        const time = hours + ":" + minutes;
        let day = date.getDate();
          if (day < 10) {
            day = "0" + day;
          }
        let month = date.getMonth() + 1 ;
          if (month < 10) {
            month = "0" + month;
          }

      comments.push({
        name: nameElement.value,
        date: day + "." + month + "." + date.getFullYear().toString().substr(-2) + " " + time,
        comment: commentElement.value,
        likes: 0,
      })

      nameElement.value = "";
      commentElement.value = "";
      renderComments();
      
    });


  </script>
</html>
