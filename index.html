<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments"></ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
          <button class="remove-form-button">Удалить последний</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
    
    const commentList = document.querySelector('.comments');
    const nameElement = document.querySelector('.add-form-name');
    const textElement = document.querySelector('.add-form-text');
    const addButton = document.querySelector('.add-form-button');
    const removeButton = document.querySelector('.remove-form-button');
    
    const comments = [
      {
        tagComment: 'li',
        classComment: 'comment',
        header: {
          tagHeader: 'div',
          classHeader: 'comment-header',
          name: 'Глеб Фокин',
          date: '12.02.22 12:18'
        },
        body: {
          tagBody: 'div',
          classBody: 'comment-body',
          html: '<div class="comment-text">Это будет первый комментарий на этой странице</div>'
        },
        footer: {
          tagFooter: 'div',
          classFooter: 'comment-footer',
          likes: {
            tagLikes: 'div',
            classLikes: 'likes',
            counter: {
              tagCounter: 'span',
              classCounter: 'likes-counter',
              value: 3
            },
            button: {
              tagButton: 'button',
              classButton: 'like-button',
              activeName: '-active-like',
              activeStatus: false
            }
          }
        }
      },
      {
        tagComment: 'li',
        classComment: 'comment',
        header: {
          tagHeader: 'div',
          classHeader: 'comment-header',
          name: 'Варвара Н.',
          date: '13.02.22 19:22'
        },
        body: {
          tagBody: 'div',
          classBody: 'comment-body',
          html: '<div class="comment-text">Мне нравится как оформлена эта страница! ❤</div>'
        },
        footer: {
          tagFooter: 'div',
          classFooter: 'comment-footer',
          likes: {
            tagLikes: 'div',
            classLikes: 'likes',
            counter: {
              tagCounter: 'span',
              classCounter: 'likes-counter',
              value: 75
            },
            button: {
              tagButton: 'button',
              classButton: 'like-button',
              activeName: '-active-like',
              activeStatus: true
            }
          }
        }
      }
    ];

    const addNewComment = () => {
      if (!nameElement.value) {
        nameElement.classList.add('form-error');
      } else if (!textElement.value) {
        textElement.classList.add('form-error');
      } else {
        commentList.innerHTML = '';

        comments.push({
          tagComment: 'li',
          classComment: 'comment',
          header: {
            tagHeader: 'div',
            classHeader: 'comment-header',
            name: `${nameElement.value}`,
            date: `${addZero((new Date).getDate())}.${addZero((new Date).getMonth())}.${editYear((new Date).getFullYear())} ${addZero((new Date).getHours())}:${addZero((new Date).getMinutes())}`
          },
          body: {
            tagBody: 'div',
            classBody: 'comment-body',
            html: `<div class="comment-text">${textElement.value}</div>`
          },
          footer: {
            tagFooter: 'div',
            classFooter: 'comment-footer',
            likes: {
              tagLikes: 'div',
              classLikes: 'likes',
              counter: {
                tagCounter: 'span',
                classCounter: 'likes-counter',
                value: 0
              },
              button: {
                tagButton: 'button',
                classButton: 'like-button',
                activeName: '-active-like',
                activeStatus: false
              }
            }
          }
        });

        renderComments();
        likeComment();
      }
    }

    const checkButton = () => {
      if (nameElement.value && textElement.value) {
        addButton.disabled = false;
      } else {
        addButton.disabled = true;
      }
    }

    const activateButton = () => {
      nameElement.addEventListener('input', () => {
        addButton.disabled = false;
      });
      textElement.addEventListener('input', () => {
        addButton.disabled = false;
      });
    }

    const removeLastComment = () => {
      commentList.innerHTML = '';
      comments.pop();

      renderComments();
    }

    const likeComment = () => {
      let likeButtons = document.querySelectorAll('.like-button');
      let likeCounters = document.querySelectorAll('.likes-counter');
 
      for (let i = 0; i < likeButtons.length; i++) {
        likeButtons[i].addEventListener('click', () => {
          if (likeButtons[i].classList.contains('-active-like')) {
            likeButtons[i].classList.remove('-active-like');
            likeCounters[i].textContent--;
          } else {
            likeButtons[i].classList.add('-active-like');
            likeCounters[i].textContent++;
          }
        });
      }
    }

    const addZero = (num) => String(num).length < 2 ? '0' + num : num;
    const editYear = (year) => String(year)[String(year).length - 2] + String(year)[String(year).length - 1];

    const renderComments = () => {
      for (let comment of comments) {
        let commentItem = document.createElement(comment.tagComment);
        commentItem.classList.add(comment.classComment);
        commentList.appendChild(commentItem);

        let itemHeader = document.createElement(comment.header.tagHeader);
        itemHeader.classList.add(comment.header.classHeader);
        itemHeader.innerHTML = `
          <div>${comment.header.name}</div>
          <div>${comment.header.date}</div>
        `;
        commentItem.appendChild(itemHeader);

        let itemBody = document.createElement(comment.body.tagBody);
        itemBody.classList.add(comment.body.classBody);
        itemBody.innerHTML = comment.body.html;
        commentItem.appendChild(itemBody);

        let itemFooter = document.createElement(comment.footer.tagFooter);
        itemFooter.classList.add(comment.footer.classFooter);
        commentItem.appendChild(itemFooter);

        let footerLikes = document.createElement(comment.footer.likes.tagLikes);
        footerLikes.classList.add(comment.footer.likes.classLikes);
        itemFooter.appendChild(footerLikes);

        let likesCounter = document.createElement(comment.footer.likes.counter.tagCounter);
        likesCounter.classList.add(comment.footer.likes.counter.classCounter);
        likesCounter.innerHTML = comment.footer.likes.counter.value;
        footerLikes.appendChild(likesCounter);

        let likesButton = document.createElement(comment.footer.likes.button.tagButton);
        likesButton.classList.add(comment.footer.likes.button.classButton);

        if (comment.footer.likes.button.activeStatus === true) {
          likesButton.classList.add(comment.footer.likes.button.activeName);
        }

        footerLikes.appendChild(likesButton);

        nameElement.value = '';
        textElement.value = '';
        nameElement.classList.remove('form-error');
        textElement.classList.remove('form-error');

        activateButton();
        checkButton();
      }
    }

    renderComments();

    addButton.addEventListener('click', addNewComment);
    textElement.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') {
          if (nameElement.value.trim() === '') {
            nameElement.classList.add('form-error');
            return;
          } else if (textElement.value.trim() === '') {
            textElement.classList.add('form-error');
            return;
          } else if ((nameElement.value.trim() === '' && textElement.value.trim() === '')) {
            nameElement.classList.add('form-error');
            textElement.classList.add('form-error');
            return;
          } else {
            addNewComment();
          }
        }
      });
      removeButton.addEventListener('click', removeLastComment);
      likeComment();
  </script>
</html>
