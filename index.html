<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="listComment">
        <!-- generation with js -->
      </ul>
      <div class="add-form">
        <input
          id = "inputGetName"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          id = "inputGetComment"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button id = "buttonDeleteLast" class="add-form-button">Удалить</button>
          <button id = "buttonSend" class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>
  <style>
    .error {
        background-color: rgb(83, 83, 83);
    }
  </style>


  <script>

    /* ------------------------------------------------------------------
    *
                                getElementById
    *
    __________________________________________________________________ */

    const sendButton = document.getElementById("buttonSend");
    const deleteButton = document.getElementById("buttonDeleteLast");
    const getListComment = document.getElementById("listComment");
    const getName = document.getElementById("inputGetName");
    const getComment = document.getElementById("inputGetComment");

    const user = [
          {
            name: "Глеб Фокин",
            date: "12.02.22 12:18",
            comment: "Это будет первый комментарий на этой странице",
            cost: "3",
            isLikeActive: false,
            like: ''
          },
          {
            name: "Варвара Н.",
            date: "13.02.22 19:22",
            comment: "Мне нравится как оформлена эта страница! ❤",
            cost: "75",
            isLikeActive: true,
            like: '-active-like'
          }
        ];

/* ------------------------------------------------------------------
                                 button event
__________________________________________________________________ */

const handerLike = () => {

    const btn = document.querySelectorAll(".like-button");

    for (const el of btn) {

        el.addEventListener('click', () => {

            const index = el.dataset.index;

            (user[index].isLikeActive === false) ? 
            (++user[index].cost, user[index].isLikeActive = true, user[index].like = '-active-like')
            : (--user[index].cost, user[index].isLikeActive = false, user[index].like = '')
              
        render();
    })
  }
}

/* ------------------------------------------------------------------
*
                                 RENDER
*
__________________________________________________________________ */

    const render = () => {
      const result = user.map((el, index) => {
        return `<li class="comment" data-index="${index}">
                  <div class="comment-header">
                    <div>${el.name}</div>
                    <div>${el.date}</div>
                  </div>
                  <div class="comment-body">
                    <div class="comment-text">
                      ${el.comment}
                    </div>
                  </div>
                  <div class="comment-footer">
                    <div class="likes">
                      <span data-cost="${el.cost}" class="likes-counter" ${el.like}>${el.cost}</span>
                      <button data-index="${index}" data-active="${el.isLikeActive}" data-active="${el.isLikeActive}" class="like-button ${el.like}"></button>
                    </div>
                  </div>
                </li>
              `}).join('');
              
              getListComment.innerHTML = result;
              handerLike();
    }

    render();

/* ------------------------------------------------------------------
*
                                 DATE
*
__________________________________________________________________ */

function myTime() {
    let myDate = new Date();
    let year = myDate.getFullYear() % 100;
    if (year < 10) year = '0' + year;
    let fullDate;
    return fullDate = myDate.getDate() + '.' + myDate.getMonth() + '.' + year + ' ' + myDate.getHours() + ':' + myDate.getMinutes();
  }

/* ------------------------------------------------------------------
*
                                    SEND
*
__________________________________________________________________ */

    sendButton.addEventListener("click", () => {
      
        if (getName.value != '' && getComment.value != '') {
          
          user.push({
              name: getName.value,
              date: myTime(),
              comment: getComment.value,
              cost: 0,
              isLikeActive: false
          })
        
          render();
        }
    });

/* ------------------------------------------------------------------
*
                            check input => grey
*
__________________________________________________________________ */

sendButton.classList.add("error")

const res = addEventListener("input", () => {
  if (getName.value != '' && getComment.value != '') {
      return sendButton.classList.remove("error");
  } else {
      return sendButton.classList.add("error"); 
  }
})

  getComment.res;
  getName.res;

/* ------------------------------------------------------------------
*
                                  delete
*
__________________________________________________________________ */

    deleteButton.addEventListener("click", () => {
          
      const numbers = getListComment.innerHTML.lastIndexOf('<li class="comment">');

      for (i = 0; i < getListComment.innerHTML.length; i++){}

      const result = i - (i - numbers);
      const deleteLastComment = getListComment.innerHTML.slice(0, result);
      getListComment.innerHTML = deleteLastComment;
    });
        
  </script>
</html>
