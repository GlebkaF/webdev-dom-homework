<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments"></ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
          <button class="remove-form-button">Удалить последний</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
    
    const commentList = document.querySelector('.comments');
    const nameElement = document.querySelector('.add-form-name');
    const textElement = document.querySelector('.add-form-text');
    const addButton = document.querySelector('.add-form-button');
    const removeButton = document.querySelector('.remove-form-button');

    const comments = [
      {
        class: 'comment',
        headerHtml: {
          class: 'comment-header',
          contentName: 'Глеб Фокин',
          contentDate: '12.02.22 12:18'
        },
        bodyHtml: {
          class: 'comment-body',
          textHtml: {
            class: 'comment-text',
            content: 'Это будет первый комментарий на этой странице'
          },
          editButtonHtml: {
            class: 'edit-button',
            isEdit: false,
            editName: 'Редактировать'
          }
        },
        footerHtml: {
          class: 'comment-footer',
          likesHtml: {
            class: 'likes',
            likeButtonHtml: {
              class: 'like-button',
              activeStatus: false,
              activeName: ''
            },
            likeCounterHtml: {
              class: 'likes-counter',
              value: 3
            }
          }
        }
      },
      {
        class: 'comment',
        headerHtml: {
          class: 'comment-header',
          contentName: 'Варвара Н.',
          contentDate: '13.02.22 19:22'
        },
        bodyHtml: {
          class: 'comment-body',
          textHtml: {
            class: 'comment-text',
            content: 'Мне нравится как оформлена эта страница! ❤'
          },
          editButtonHtml: {
            class: 'edit-button',
            isEdit: false,
            editName: 'Редактировать'
          }
        },
        footerHtml: {
          class: 'comment-footer',
          likesHtml: {
            class: 'likes',
            likeButtonHtml: {
              class: 'like-button',
              activeStatus: true,
              activeName: '-active-like'
            },
            likeCounterHtml: {
              class: 'likes-counter',
              value: 75
            }
          }
        }
      }
    ];

    const renderComments = () => {
      commentList.innerHTML = comments.map((el, i) => {
        return `<li class="${el.class}">
          <div class="${el.headerHtml.class}">
            <div>${el.headerHtml.contentName}</div>
            <div>${el.headerHtml.contentDate}</div>
          </div>
          <div class="${el.bodyHtml.class}">
            <div class="${el.bodyHtml.textHtml.class}">${el.bodyHtml.textHtml.content}</div>
            <button class="${el.bodyHtml.editButtonHtml.class}" data-index=${i}>${el.bodyHtml.editButtonHtml.editName}</button>
          </div>
          <footer class="${el.footerHtml.class}">
            <div class="${el.footerHtml.likesHtml.class}">
              <span class="${el.footerHtml.likesHtml.likeCounterHtml.class}">
                ${el.footerHtml.likesHtml.likeCounterHtml.value}  
              </span>
              <button class="${el.footerHtml.likesHtml.likeButtonHtml.class} ${el.footerHtml.likesHtml.likeButtonHtml.activeName}" data-index="${i}"></button>  
            </div>
          </footer>
        </li>`;
      }).join('');

      checkAddButton();
      activateAddButton();
      likeComment();
      editComment();
    }

    const checkAddButton = () => {
      if (!nameElement.value.trim() || !textElement.value.trim()) {
        addButton.disabled = true;
      }
    }
    const activateAddButton = () => {
      nameElement.addEventListener('input', () => {
        if (textElement.value.trim()) {
          addButton.disabled = false;
        }
      });
      textElement.addEventListener('input', () => {
        if (nameElement.value.trim()) {
          addButton.disabled = false;
        }
      });
    }
    const deleteLastComment = () => {
      comments.pop();

      renderComments();
    }
    const addComment = () => {
      let day = addZeroBefore((new Date).getDate());
      let month = addZeroBefore((new Date).getMonth());
      let year = editYear((new Date).getFullYear());
      let hours = addZeroBefore((new Date).getHours());
      let minutes = addZeroBefore((new Date).getMinutes());

      if (!nameElement.value.trim()) {
        nameElement.classList.add('form-error');
        return;
      } else if (!textElement.value.trim()) {
        textElement.classList.add('form-error');
        return;
      } else {
        comments.push({
          class: 'comment',
          headerHtml: {
            class: 'comment-header',
            contentName: `${nameElement.value}`,
            contentDate: `${day}.${month}.${year} ${hours}:${minutes}`
          },
          bodyHtml: {
            class: 'comment-body',
            textHtml: {
              class: 'comment-text',
              content: `${textElement.value}`
            },
            editButtonHtml: {
              class: 'edit-button',
              isEdit: false,
              editName: 'Редактировать'
            }
          },
          footerHtml: {
            class: 'comment-footer',
            likesHtml: {
              class: 'likes',
              likeButtonHtml: {
                class: 'like-button',
                activeStatus: false,
                activeName: ''
              },
              likeCounterHtml: {
                class: 'likes-counter',
                value: 0
              }
            }
          }
        });

        nameElement.value = '';
        textElement.value = '';
        nameElement.classList.remove('form-error');
        textElement.classList.remove('form-error');
      }

      renderComments();
    }
    const likeComment = () => {
      const likeButtons = document.querySelectorAll('.like-button');

      for (let button of likeButtons) {
        button.addEventListener('click', () => {
          if (!comments[button.dataset.index].footerHtml.likesHtml.likeButtonHtml.activeStatus) {
            comments[button.dataset.index].footerHtml.likesHtml.likeCounterHtml.value++;
            comments[button.dataset.index].footerHtml.likesHtml.likeButtonHtml.activeName = '-active-like';
          } else {
            comments[button.dataset.index].footerHtml.likesHtml.likeCounterHtml.value--;
            comments[button.dataset.index].footerHtml.likesHtml.likeButtonHtml.activeName = '';
          }

          comments[button.dataset.index].footerHtml.likesHtml.likeButtonHtml.activeStatus = !comments[button.dataset.index].footerHtml.likesHtml.likeButtonHtml.activeStatus;

          renderComments();
        });
      }
    }
    const editComment = () => {
      const editButtons = document.querySelectorAll('.edit-button');
      const editArea = document.querySelector('.edit-area');

      for (let button of editButtons) {
        button.addEventListener('click', () => {
          if (!comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit) {
            comments[button.dataset.index].bodyHtml.textHtml.content = `<textarea class="edit-area">${comments[button.dataset.index].bodyHtml.textHtml.content}</textarea>`;
            comments[button.dataset.index].bodyHtml.editButtonHtml.editName = 'Сохранить';
            comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit = !comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit;
          } else if (!editArea.value.trim() && comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit) {
            comments[button.dataset.index].bodyHtml.textHtml.content = '<textarea class="edit-area form-error"></textarea>';
          } else {
            comments[button.dataset.index].bodyHtml.textHtml.content = `${editArea.value}`;
            comments[button.dataset.index].bodyHtml.editButtonHtml.editName = 'Редактировать';
            comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit = !comments[button.dataset.index].bodyHtml.editButtonHtml.isEdit;
          }

          renderComments();
        });
      }
    }
    const addZeroBefore = num => String(num).length < 2 ? '0' + num : num;
    const editYear = year => String(year)[2] + String(year)[3];

    addButton.addEventListener('click', addComment);
    textElement.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        addComment();
      }
    });
    removeButton.addEventListener('click', deleteLastComment);

    renderComments();
  </script>
</html>