<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul id="comments" class="comments">
        <!-- Список рендерится из JS -->
      </ul>
      <div id="add-form" class="add-form">
        <input
          id="name-input"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          id="comment-input"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button id="add-button" class="add-form-button">Написать</button>
        </div>

        <div class="add-form-row">
          <button id="remove-button" class="add-form-button">Удалить последний комментарий</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    const commentsElement = document.getElementById('comments');
    const nameInput = document.getElementById('name-input');
    const addForm = document.getElementById('add-form');
    const commentInput = document.getElementById('comment-input');
    const addButton = document.getElementById('add-button');
    const removeButton = document.getElementById('remove-button');

    let comments = [
      {
        name: 'Глеб Фокин',
        commentText: 'Это будет первый комментарий на этой странице',
        date: '12.02.22 12:18',
        likes: 3,
        isLiked: '',
      },
      {
        name: 'Варвара Н.',
        commentText: 'Мне нравится как оформлена эта страница! ❤',
        date: '13.02.22 19:22',
        likes: 75,
        isLiked: '-active-like',
      },       
    ];

    const initLikeEventListeners = () => {
      const likeButtons = Array.from(document.querySelectorAll('.like-button'));
      const likesCounters = Array.from(document.querySelectorAll('.likes-counter'));
      

      likeButtons.forEach((likeButton, index) => {
        likeButton.addEventListener("click", () => {
          const index = likeButton.dataset.index;
          if (comments[index].isLiked === '-active-like') {
            comments[index].isLiked = ''
            comments[index].likes -= 1;
          } else {
            comments[index].isLiked = '-active-like';
            comments[index].likes += 1;

          }
        renderComments();
      });
    });

  }


  const initAnswerOnCommentEventListeners = () => {
    const commentsText = Array.from(document.querySelectorAll('.comment-text'));

    commentsText.forEach((commentTexts, index) => {
      commentTexts.addEventListener('click', () => {
        const answerIndex = commentTexts.dataset.index;
        const quote = comments[answerIndex].commentText;
        commentInput.value = quote;

        renderComments();
      })
    })

  }

  
  const renderComments = () => {
    const commentsHtml = comments.map((comment, index) => {
        return `<li class="comment">
                  <div class="comment-header">
                    <div>${comment.name}</div>
                    <div>${comment.date}</div>
                  </div>
                  <div class="comment-body">
                    <div data-index='${index}' class="comment-text">
                    ${comment.commentText}
                    </div>
                  </div>
                  <div class="comment-footer">
                    <div class="likes">
                      <span class="likes-counter">${comment.likes}</span>
                      <button data-index='${index}' class="like-button ${comment.isLiked}"></button>
                    </div>
                  </div>
                </li>`;
    }).join('');
    
    commentsElement.innerHTML = commentsHtml;
    initLikeEventListeners();
    };

    renderComments();


    const removeComment = () => {
      comments.pop();
      renderComments();
    }



    function addComment() {

      nameInput.classList.remove('error');
      commentInput.classList.remove('error');

      if (nameInput.value === '' || commentInput.value === '') {
        nameInput.classList.add('error');
        commentInput.classList.add('error');
        return;
      }

      comments.push({
        name: nameInput.value.replaceAll('<', '&lt'),
        commentText: commentInput.value.replaceAll('>', '&gt'),
        date: `${new Date().toLocaleString().slice(0, -3)}`,
        likes: 0,
        isLiked: '',
      });

        renderComments();

        nameInput.value = '';
        commentInput.value = '';
    }



    addButton.addEventListener('click', () => {
      addComment();
    });


    addForm.addEventListener('keydown', (event) => {

      if (event.code !== 'Enter') {
        return;
      }

      addComment();
    });

    removeButton.addEventListener('click', removeComment);


  </script>
</html>
