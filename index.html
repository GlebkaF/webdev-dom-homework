<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css" />

  <title>Комментарии</title>
  <style>
    .error {
      background: linear-gradient(to right, rgb(189, 91, 91), rgb(229, 20, 55));
    }

    .disabled-button {
      background-color: #ffffffbe;
    }

    .like-button.active-like {

      background-color: red;
      color: white;
      
    }
  </style>
</head>
<body>
  <div class="container">
    <ul id="comments" class="comments">
      <!-- Список рендерится из JS -->
    </ul>
    <div class="add-form">
      <input
        id="name-input"
        type="text"
        class="add-form-name"
        placeholder="Введите ваше имя"
      />
      <textarea
        id="comment-input"
        type="textarea"
        class="add-form-text"
        placeholder="Введите ваш комментарий"
        rows="4"
      ></textarea>
      <div class="add-form-row">
        <button id="add-button" class="add-form-button">Написать</button>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    const buttonElement = document.getElementById("add-button");
    const commentsElement = document.getElementById("comments");
    const nameInputElement = document.getElementById("name-input");
    const commentInputElement = document.getElementById("comment-input");

    // Установка формата даты ДД.ММ.ГГГГ ЧЧ:ММ
    const getDate = () => {
      const currentDate = new Date();
      const day = String(currentDate.getDate()).padStart(2, "0");
      const month = String(currentDate.getMonth() + 1).padStart(2, "0");
      const year = currentDate.getFullYear();
      const hours = String(currentDate.getHours()).padStart(2, "0");
      const minutes = String(currentDate.getMinutes()).padStart(2, "0");

      return `${day}.${month}.${year} ${hours}:${minutes}`;
    };

    // Функция клика, валидация
    buttonElement.addEventListener("click", () => {
      nameInputElement.classList.remove("error");
      commentInputElement.classList.remove("error");

      if (nameInputElement.value.trim() === "" || commentInputElement.value.trim() === "") {
        nameInputElement.classList.add("error");
        commentInputElement.classList.add("error");
        return;
      }

      const newComment = {
        name: nameInputElement.value.trim(),
        dateComment: getDate(),
        text: commentInputElement.value.trim(),
        likes: 0,
        liked: false,
      };

      users.push(newComment);
      renderUsers();

      nameInputElement.value = "";
      commentInputElement.value = "";
    });

    // Добавление комментария клавишей Enter
    document.addEventListener("keyup", (event) => {
      if (event.code === "Enter") {
        buttonElement.click();
      }
    });

    // Массив данных
    const users = [
      {
        name: "Глеб Фокин",
        dateComment: "12.02.22 12:18",
        text: "Это будет первый комментарий на этой странице",
        likes: 3,
        liked: false,
      },
      {
        name: "Варвара Н.",
        dateComment: "13.02.22 19:22",
        text: "Мне нравится как оформлена эта страница! ❤",
        likes: 75,
        liked: false,
      },
    ];

    // Рендер функция
    const renderUsers = () => {
      const userHtml = users
        .map((user, index) => {
          const likeButtonClass = user.liked ? "like-button active-like" : "like-button";
          const editButton = user.editing
            ? `<button class="save-button" data-index="${index}">Сохранить</button>`
            : `<button class="edit-button" data-index="${index}">Редактировать</button>`;
          const commentContent = user.editing
            ? `<textarea class="comment-edit" data-index="${index}">${user.text}</textarea>`
            : `<div class="comment-text">${user.text}</div>`;

          return `<li class="comment">
            <div class="comment-header">
              <div>${user.name}</div>
              <div>${user.dateComment}</div>
            </div>
            <div class="comment-body">
              ${commentContent}
            </div>
            <div class="comment-footer">
              <div class="likes">
                <span class="likes-counter">${user.likes}</span>
                <button class="${likeButtonClass}" data-index="${index}"></button>
              </div>
              ${editButton}
            </div>
          </li>`;
        })
        .join("");

      commentsElement.innerHTML = userHtml;
    };

    renderUsers();

    // Лайки 
    commentsElement.addEventListener("click", (event) => {
      if (event.target.classList.contains("like-button")) {
        const index = event.target.dataset.index;
        const user = users[index];

        if (user.liked) {
          user.likes -= 1;
        } else {
          user.likes += 1;
        }

        user.liked = !user.liked;
        renderUsers();

        event.target.classList.toggle("active-like"); // Добавляем/удаляем класс "active-like"
      }

      if (event.target.classList.contains("edit-button")) {
        const index = event.target.dataset.index;
        const user = users[index];
        user.editing = true;
        renderUsers();
      }

      if (event.target.classList.contains("save-button")) {
        const index = event.target.dataset.index;
        const user = users[index];
        const textareaElement = document.querySelector(`textarea[data-index="${index}"]`);

        user.text = textareaElement.value.trim();
        user.editing = false;
        renderUsers();
      }
    });

    console.log("It works!");
  </script>
</body>
</html>