<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="list">
        <!--список рендерится из js -->
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          id="name-input"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
          id="text-input"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="send-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    const nameInputElement = document.getElementById("name-input");
    const textInputElement = document.getElementById("text-input");
    const buttonElement = document.getElementById("send-button");
    const listElement = document.getElementById("list");
    //отображение даты в выбранном формате
    let currentDate = new Date();
    let formattedDateTime = ('0' + currentDate.getDate()).slice(-2) + '.' + ('0' + (currentDate.getMonth() + 1)).slice(-2) + '.' + ('' + currentDate.getFullYear()).slice(-2) + ' ' + ('0' + currentDate.getHours()).slice(-2) + ':' + ('0' + currentDate.getMinutes()).slice(-2);
    const comments = [
      {
        name:"Глеб Фокин",
        date:"12.02.22 12:18",
        text:"Это будет первый комментарий на этой странице",
        isLiked:false,
        likeCount:73
      },
      {
        name:"Варвара H.",
        date:"13.02.22 19:22",
        text:"Мне нравится как оформлена эта страница! ❤",
        isLiked:true,
        likeCount:3
      },
    ];

    //формирую html разметку на основе массива
    const renderComments = () => {
  const commentsHtml = comments.map((comment, index) => {
    // Добавляем класс active-like, если isLiked равно true
    const likeButtonClass = comment.isLiked ? 'like-button active-like' : 'like-button';
    
    return `<li class="comment">
      <div class="comment-header">
        <div>${comment.name}</div>
        <div>${comment.date}</div>
      </div>
      <div class="comment-body">
        <div class="comment-text">
          ${comment.text}
        </div>
      </div>
      <div class="comment-footer">
        <div class="likes">
          <span class="likes-counter">${comment.likeCount}</span>
          <button data-index="${index}" class="${likeButtonClass}"></button>
        </div>
      </div>
    </li>`;
  }).join("");
  
  listElement.innerHTML = commentsHtml;
  
  // Не забудьте заново инициализировать слушателей кнопок "лайк"
  initLikeButtonListeners();
};


          //инициализация обработчика событий на клик по кнопке лайка
          const initLikeButtonListeners = () => {
  const likeButtonElements = document.querySelectorAll(".like-button");

  for (const likeButtonElement of likeButtonElements) {
    likeButtonElement.addEventListener('click', () => {
      const index = likeButtonElement.dataset.index;

      // Изменяем значение isLiked и число лайков в соответствии с текущим состоянием кнопки 
      comments[index].isLiked = !comments[index].isLiked;
      if (comments[index].isLiked) {
        comments[index].likeCount++;
      } else {
        comments[index].likeCount--;
      }

      // Обновляем отображение кнопки "лайк"
      renderComments();
    });
  }
};

// Вызов функции инициализации слушателей
initLikeButtonListeners();
    //Обработчик событий на кнопку отправить
    buttonElement.addEventListener('click', () =>{
      nameInputElement.classList.remove('error');
        textInputElement.classList.remove('error');
       // Валидация инпута на пустые строки
       if(nameInputElement.value.trim() === '' && textInputElement.value.trim() === ''){
        nameInputElement.classList.add('error');
        textInputElement.classList.add('error');
        return;
        }
        else if(textInputElement.value.trim() === ''){
            textInputElement.classList.add('error');
            return;
        }
        else if(nameInputElement.value.trim() === ''){
            nameInputElement.classList.add('error');
            return;
        };
    //добавление комментария на страницу

      comments.push({
        name:nameInputElement.value,
        date:formattedDateTime,
        text:textInputElement.value,
        isLiked:false,
        likeCount:0
      });
      renderComments();
        //очистка инпута от старого ввода
        textInputElement.value = '';
        nameInputElement.value = '';
    });
    
    renderComments();
  </script>
</html>