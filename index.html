<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="commentsId">
        <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.2022 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.2022 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">

            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li>
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          id="nameTextId"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
          id="commentTextId"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="btnId">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    const {log} = console;
    // ------------------
    "use strict"
    // Добавляем ДОМ элементы
    const cardElements = document.getElementById("commentsId");
    const btnElement = document.getElementById("btnId");
    const inputName = document.getElementById("nameTextId");
    const inputText = document.getElementById("commentTextId");
    const likeElement = document.getElementsByClassName("like-button");

    // Вспомогательные функции
    const commentDellAnimation = () => {
        const cardElement =  cardElements.children;
        Array.from(cardElement).forEach(el => {
            el.classList.remove('comment_animation')
        })
    }

    const addDate = () => {
      const date = new Date();
      let time = {
        hour: 'numeric',
        minute: 'numeric',
      };
      let year = {
        year: 'numeric',
        month: 'numeric',
        day: 'numeric',
      }

      return  date.toLocaleString("ru", year) + " " + date.toLocaleString('ru', time);
    }

    const delCardAddAnimation = (element) => element.parentElement.parentElement.classList.add('del-card')
    const btnErrAdd = () => {
        btnElement.classList.add("btn-error");
    }

    const btnErrRemove = () => {
      btnElement.classList.remove("btn-error");
    }


    // Функция добавления лайка
    function search () {
      Array.from(likeElement).forEach((element) => {
        element.addEventListener('click', () => {
          const condition = element.className.split(" ")
          if (condition.includes("-active-like")){
            element.classList.remove("-active-like");
            const parent = element.parentElement;
            const number = parent.firstElementChild;
            let counter = +(number.innerText);
            number.innerHTML = counter - 1;


          } else {
            element.classList.add("-active-like")
            const parent = element.parentElement;
            const number = parent.firstElementChild;
            let counter = +(number.innerText);
            number.innerHTML = counter + 1;
          }

        })
      })
    }
    search()

    // Функция добавления нового комментария

    const clickEvent = () => {
        commentDellAnimation();

        inputText.classList.remove("error");
        inputName.classList.remove("error");

        if (inputText.value.length === 0 && inputName.value.length === 0) {
            inputName.classList.add("error");
            inputText.classList.add("error");
            btnErrRemove()
            btnErrAdd()
            return;
        }

        if (inputName.value.length === 0) {
            inputName.classList.add("error");
            btnErrRemove()
            btnErrAdd()
            return;
        }

        if (inputText.value.length === 0) {
            inputText.classList.add("error");
            btnErrRemove()
            btnErrAdd()
            return;
        }
        const textHtml = `<li class="comment comment_animation">
      <div class="comment-header">
        <div>${inputName.value}</div>
        <div>${addDate()}</div>
      </div>
      <div class="comment-body">
        <div class="comment-text">
          ${inputText.value}
        </div>
      </div>
      <div class="comment-footer comment-footer_new">
      <button class="add-form-button del">Удалить</button>
        <div class="likes">
          <span class="likes-counter">0</span>
          <button class="like-button"></button>
        </div>
      </div>
    </li>`;
        cardElements.innerHTML += textHtml;
        document.getElementById("nameTextId").value = '';
        document.getElementById("commentTextId").value = '';
        // Вспомогательная функция для удаления комментария

        const btnFormElement = document.querySelectorAll(".del");
        btnFormElement.forEach((element) => {
            element.addEventListener('click', () => {

                delCardAddAnimation(element)
                log(element)
                setTimeout(() => {
                  element.parentElement.parentElement.remove();
                },500)
            })
        })
        btnErrRemove()
        search()
    }





    document.addEventListener('keyup', (key) => {
        if(key.code === 'Enter'){
            clickEvent()
        }
    })

    btnElement.addEventListener( 'click', () => clickEvent())
    log("It works!");
  </script>
</html>
