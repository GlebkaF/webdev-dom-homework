<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Урок "Асинхронность"</title>
</head>

<body>
    <h1>Список задач</h1>
    <ul class="tasks" id="list">
        <!-- Список рендерится из JS -->
    </ul>
    <br />
    <div class="form">
        <h3 class="form-title">Форма добавления</h3>
        <div class="form-row">
            Что нужно сделать:
            <input type="text" id="text-input" class="input" placeholder="Выпить кофе" />
        </div>
        <br />
        <button class="button" id="add-button">Добавить</button>
    </div>
</body>

<script>
    const buttonElement = document.getElementById("add-button");
    const listElement = document.getElementById("list");
    const textInputElement = document.getElementById("text-input");

    let tasks = [
        {
            text: "Купить чай"
        },
        {
            text: "Заварить чай"
        },
        {
            text: "Выпить чай"
        }
    ];

    const renderTasks = () => {
        const tasksHtml = tasks
            .map((task, index) => {
                return `
          <li class="task">
            <p class="task-text">
              ${task.text
                        .replaceAll("&", "&amp;")
                        .replaceAll("<", "&lt;")
                        .replaceAll(">", "&gt;")
                        .replaceAll('"', "&quot;")}
              <button data-index="${index}" class="button delete-button">Удалить</button>
            </p>
          </li>`;
            })
            .join("");

        listElement.innerHTML = tasksHtml;
        const deleteButtons = document.querySelectorAll(".delete-button");

        for (const deleteButton of deleteButtons) {
            deleteButton.addEventListener("click", (event) => {
                event.stopPropagation();
                deleteButton.innerHTML = "Задача удаляется...";

                setTimeout(() => {
                    const index = deleteButton.dataset.index;

                    tasks.splice(index, 1);

                    renderTasks();
                }, 1000);
            });
        }
    };

    renderTasks();

    buttonElement.addEventListener("click", () => {
        if (textInputElement.value === "") {
            return;
        }

        tasks.push({
            text: textInputElement.value
        });

        renderTasks();

        textInputElement.value = "";
    });
</script>

</html>